<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ</title>
    <link rel="stylesheet" href="../../CSS/style.css">
    <script src="../../navbar.js" defer></script>
    <link rel="icon" href="https://abdo12249.github.io/1/navbar/favicon.ico" type="image/x-icon">
</head>

<body>
    <div id="navbar-container"></div>

    <main>
        <div class="section-header">
            <h1 id="categoryTitle">Ø§Ù„ØªØµÙ†ÙŠÙ</h1>
        </div>

        <div class="anime-grid" id="animeGrid"></div>
        <a href="index.html" class="back-button">ğŸ”™ Ø§Ù„Ø±Ø¬ÙˆØ¹ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
    </main>

    <script>
        let categoryName = new URLSearchParams(window.location.search).get('category'); // Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØµÙ†ÙŠÙ Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø·
        document.getElementById('categoryTitle').textContent = `ØªØµÙ†ÙŠÙ: ${categoryName}`;

        async function loadAnimeCategories() {
            try {
                const response = await fetch('../jave/animeCategories.json');
                if (!response.ok) throw new Error("ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ animeCategories.json");

                const data = await response.json();
                if (!Array.isArray(data.animes)) throw new Error("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ animeCategories.json ØºÙŠØ± ØµØ­ÙŠØ­Ø©!");

                for (const animeFile of data.animes) {
                    await loadAnimeData(animeFile);
                }
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ:', error);
            }
        }

        async function loadAnimeData(animeFile) {
            try {
                const response = await fetch(`../jave/${animeFile}`);
                if (!response.ok) throw new Error(`ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ${animeFile}`);

                const anime = await response.json();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø£Ù†Ù…ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
                if (anime.categories.includes(categoryName)) {
                    displayAnime(anime);
                }
            } catch (error) {
                console.error(`âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù†Ù…ÙŠ Ù…Ù† ${animeFile}:`, error);
            }
        }

        function displayAnime(anime) {
            const animeGrid = document.getElementById('animeGrid');
            const card = document.createElement('div');
            card.className = 'anime-card';

            card.innerHTML = `
                <div class="anime-image">
                    <img src="${anime.image}" alt="${anime.name}" loading="lazy">
                    <div class="rating">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                        </svg>
                        ${anime.rating}
                    </div>
                </div>
                <div class="anime-info">
                    <h3>${anime.name}</h3>
                    <div class="anime-meta">
                        <span>${anime.categories.join(', ')}</span>
                        <a href="${anime.link}" class="watch-button">Ø´Ø§Ù‡Ø¯ Ø§Ù„Ø¢Ù†</a>
                    </div>
                </div>
            `;
            animeGrid.appendChild(card);
        }

        loadAnimeCategories();
    </script>

    <script>
        fetch('../../navbar.html')
            .then(response => response.text())
            .then(data => document.getElementById('navbar-container').innerHTML = data)
            .catch(error => console.error('âŒ Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù„ÙˆÙŠ:', error));
    </script>
</body>
</html>
